import{c as b,u as P,r as c,j as e,h as Q,B as I,M as E,P as V,I as M,g as B,t as $,s as z}from"./index-Ru6Kzlbq.js";import{C as L}from"./circle-check-rZAev9O-.js";const G=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],H=b("arrow-up-right",G);const T=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],J=b("grip-vertical",T);const K=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],W=b("info",K);function Z(){const{sectors:j,addLoan:U,currentUser:q,userRole:v,reorderSectors:_}=P(),[r,w]=c.useState(null),[o,u]=c.useState(null),[i,h]=c.useState(null),[N,y]=c.useState(1),[x,g]=c.useState(7),[m,k]=c.useState(null),[p,f]=c.useState(!1),l=v==="admin_master"||v==="admin_infra";if(!l)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] text-center space-y-4",children:[e.jsx("div",{className:"bg-yellow-100 p-4 rounded-full",children:e.jsx(Q,{className:"h-8 w-8 text-yellow-600 animate-spin"})}),e.jsx("h2",{className:"text-xl font-semibold text-secondary-800 dark:text-secondary-100",children:"Em Manutenção"}),e.jsx("p",{className:"text-secondary-600 dark:text-secondary-400 max-w-md",children:"A área de Infraestrutura está passando por ajustes no inventário. Por favor, tente novamente mais tarde."}),e.jsx(I,{variant:"outline",onClick:()=>window.location.href="/",children:"Voltar para Home"})]});const A=s=>{l&&h(s)},R=(s,t)=>{s.preventDefault()},F=(s,t)=>{if(s.preventDefault(),!l||i===null||i===t){h(null);return}const a=[...j],d=a[i];a[i]=a[t],a[t]=d,_(a),h(null)},D=async s=>{if(o){if(!m){$.error("É obrigatório enviar uma foto do item.");return}f(!0);let t="";try{const n=m.name.split(".").pop(),C=`loan-withdrawal-${Date.now()}-${Math.random().toString(36).substring(7)}.${n}`,{error:S}=await z.storage.from("photos").upload(C,m);if(S)throw S;const{data:O}=z.storage.from("photos").getPublicUrl(C);t=O.publicUrl}catch(n){console.error("Upload Error:",n),$.error("Erro ao enviar foto."),f(!1);return}let a;if(s==="Empréstimo"){const n=new Date;n.setDate(n.getDate()+x),a=n.toISOString()}await U(o.id,s,N,a,t)&&(u(null),y(1),g(7),k(null)),f(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight mb-2",children:"Infraestrutura e Inventário"}),e.jsx("p",{className:"text-secondary-500 dark:text-secondary-400",children:"Visualize a organização do armário e localize os materiais disponíveis."})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative bg-[#5D4037] p-4 rounded-lg shadow-2xl border-4 border-[#3E2723] max-w-4xl w-full",children:[e.jsx("div",{className:"absolute -top-3 left-0 right-0 h-4 bg-[#4E342E] rounded-t-lg mx-2"}),e.jsx("div",{className:"grid grid-cols-2 gap-4 bg-[#3E2723] p-4 rounded border-2 border-[#5D4037]",style:{gridTemplateRows:"repeat(14, minmax(40px, 1fr))"},children:j.map((s,t)=>{let a="";return t===0?a="col-start-1 row-start-1 row-span-2":t===1?a="col-start-2 row-start-1 row-span-2":t===2?a="col-start-1 row-start-3 row-span-2":t===3?a="col-start-2 row-start-3 row-span-2":t===4?a="col-start-1 row-start-5 row-span-2":t===5?a="col-start-2 row-start-5 row-span-2":t===6?a="col-start-1 row-start-7 row-span-2":t===7?a="col-start-1 row-start-9 row-span-2":t===8?a="col-start-1 row-start-11 row-span-2":t===9?a="col-start-1 row-start-13 row-span-2":t===10?a="col-start-2 row-start-7 row-span-5":t===11&&(a="col-start-2 row-start-12 row-span-3"),e.jsxs("div",{draggable:l,onDragStart:()=>A(t),onDragOver:d=>R(d),onDrop:d=>F(d,t),onClick:()=>w(s),className:`group relative bg-[#D7CCC8]/10 hover:bg-[#D7CCC8]/20 border-2 border-[#A1887F]/30 hover:border-[#A1887F] rounded transition-all ${l?"cursor-move":"cursor-pointer"} flex flex-col items-center justify-center overflow-hidden ${a} ${i===t?"opacity-50":""}`,children:[e.jsx("div",{className:"absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/wood-pattern.png')] pointer-events-none"}),e.jsxs("div",{className:"z-10 text-center p-2 transition-transform group-hover:scale-110",children:[e.jsx("span",{className:"block text-white/90 font-bold text-lg drop-shadow-md",children:s.name}),e.jsx("span",{className:"block text-white/60 text-xs uppercase tracking-wider text-[10px]",children:s.category})]}),l&&e.jsx("div",{className:"absolute top-2 left-2 opacity-60 group-hover:opacity-100 transition-opacity",children:e.jsx(J,{className:"text-white/80 h-4 w-4"})}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(W,{className:"text-white/80 h-4 w-4"})}),e.jsxs("div",{className:"absolute bottom-2 right-2 bg-primary-600/90 text-white text-[10px] px-2 py-0.5 rounded-full shadow-sm",children:[s.items.length," itens"]})]},s.id)})}),e.jsx("div",{className:"absolute -bottom-3 left-0 right-0 h-4 bg-[#4E342E] rounded-b-lg mx-2"})]})}),e.jsx(E,{isOpen:!!r,onClose:()=>w(null),title:r?r.name:"Detalhes do Setor",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between bg-primary-50 dark:bg-primary-900/20 p-3 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-secondary-600 dark:text-secondary-300",children:"Categoria"}),e.jsx("span",{className:"font-bold text-primary-700 dark:text-primary-400",children:r?.category})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2 flex items-center text-secondary-700 dark:text-secondary-200",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Itens Armazenados (",r?.items.length,")"]}),e.jsx("div",{className:"bg-secondary-50 dark:bg-secondary-900/50 rounded-lg p-4 max-h-[300px] overflow-y-auto border border-secondary-100 dark:border-secondary-800",children:r?.items.length===0?e.jsx("p",{className:"text-sm text-secondary-500 italic text-center py-4",children:"Este setor está vazio."}):e.jsx("ul",{className:"space-y-3",children:r?.items.map(s=>e.jsxs("li",{className:"text-sm border-b border-dashed border-secondary-200 dark:border-secondary-800 last:border-0 pb-2 last:pb-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-primary-500 rounded-full mt-1.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-secondary-900 dark:text-secondary-100",children:s.name}),s.code&&e.jsx("span",{className:"ml-2 text-xs text-secondary-500 bg-secondary-200 dark:bg-secondary-800 px-1 rounded font-mono",children:s.code})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium
                                                        ${s.status==="Disponível"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":s.status==="Indisponível"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"}
                                                    `,children:s.status}),q&&s.quantity>0&&e.jsx(I,{size:"sm",variant:"outline",className:"h-6 text-xs",onClick:()=>{u(s),y(1),g(7)},children:"Solicitar"})]})]}),e.jsxs("div",{className:"pl-3.5 mt-1 text-xs text-secondary-500",children:["Quantidade disponível: ",s.quantity]})]},s.id))})})]})]})}),e.jsx(E,{isOpen:!!o,onClose:()=>u(null),title:"Realizar Empréstimo",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-secondary-50 dark:bg-secondary-900 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-secondary-600 dark:text-secondary-300 mb-1",children:"Item selecionado:"}),e.jsx("p",{className:"font-bold text-lg",children:o?.name}),e.jsxs("p",{className:"text-xs text-secondary-500 mt-1",children:["Disponível em estoque: ",o?.quantity]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(M,{label:"Quantidade",type:"number",min:1,max:o?.quantity||1,value:N,onChange:s=>y(Math.min(Math.max(1,parseInt(s.target.value)||1),o?.quantity||1))})}),e.jsx("div",{className:"space-y-2",children:e.jsx(M,{label:"Devolver em (dias)",type:"number",min:1,value:x,onChange:s=>g(Math.max(1,parseInt(s.target.value)||1))})})]}),x>0&&e.jsxs("p",{className:"text-sm text-secondary-500",children:["Data prevista de devolução: ",e.jsx("span",{className:"font-semibold",children:(()=>{const s=new Date;return s.setDate(s.getDate()+x),s.toLocaleDateString()})()})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Foto do Item (Obrigatório)"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:s=>k(s.target.files?.[0]||null),className:"hidden",id:"loan-photo-upload"}),e.jsx("label",{htmlFor:"loan-photo-upload",className:"flex items-center justify-center w-full p-4 border-2 border-dashed border-secondary-300 rounded-lg cursor-pointer hover:bg-secondary-50 transition-colors",children:m?e.jsxs("span",{className:"text-sm text-green-600 font-medium flex items-center",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),m.name]}):e.jsxs("span",{className:"text-sm text-secondary-500 flex items-center",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Clique para tirar ou escolher foto"]})})]})}),e.jsx("p",{className:"text-xs text-secondary-500",children:"Registre o estado atual do item antes de retirar."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("button",{onClick:()=>D("Empréstimo"),disabled:p,className:`flex items-center justify-between p-4 border border-secondary-200 dark:border-secondary-800 rounded-lg hover:bg-primary-50 dark:hover:bg-primary-900/20 hover:border-primary-200 transition-all text-left group
                                ${p?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{children:[e.jsx("span",{className:"block font-semibold text-primary-700 dark:text-primary-400 group-hover:text-primary-800",children:"Confirmar Empréstimo"}),e.jsx("span",{className:"text-xs text-secondary-500",children:"Item será devolvido ao estoque."})]}),e.jsx(H,{className:"h-5 w-5 text-secondary-400 group-hover:text-primary-500"})]}),e.jsxs("button",{onClick:()=>D("Uso Contínuo"),disabled:p,className:`flex items-center justify-between p-4 border border-secondary-200 dark:border-secondary-800 rounded-lg hover:bg-secondary-50 dark:hover:bg-secondary-900 hover:border-secondary-300 transition-all text-left group
                                ${p?"opacity-50 cursor-not-allowed":""}`,children:[e.jsxs("div",{children:[e.jsx("span",{className:"block font-semibold text-secondary-800 dark:text-secondary-200",children:"Confirmar Uso Contínuo"}),e.jsx("span",{className:"text-xs text-secondary-500",children:"Item será consumido/sem devolução."})]}),e.jsx(L,{className:"h-5 w-5 text-secondary-400 group-hover:text-secondary-600"})]})]})]})})]})}export{Z as default};
