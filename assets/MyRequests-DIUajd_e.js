import{u as R,r as d,j as e,B as a,F as f,P as v,L as m,M as U,g as P,t as w,s as k}from"./index-_QvtUJN5.js";import{C as r,c as o}from"./Card-cyhYrOI8.js";import{T as F}from"./ticket-De6ChATJ.js";import{U as M}from"./users-C94vnpS7.js";import{C as T}from"./circle-check-DtWK9-M6.js";function O(){const{tickets:C,evaluations:A,currentUser:l,loans:D,returnLoan:S}=R(),[t,c]=d.useState("tickets"),[i,x]=d.useState(null),[n,h]=d.useState(null),[u,p]=d.useState(!1),j=C.filter(s=>s.author===l),y=A.filter(s=>s.author===l),N=D.filter(s=>s.userName===l&&(s.status==="Ativo"||s.status==="Aguardando Aprova√ß√£o"||s.status==="Atrasado")),E=async()=>{if(!i||!n){w.error("√â obrigat√≥rio enviar uma foto da devolu√ß√£o.");return}p(!0);try{const s=n.name.split(".").pop(),g=`loan-return-${Date.now()}-${Math.random().toString(36).substring(7)}.${s}`,{error:b}=await k.storage.from("photos").upload(g,n);if(b)throw b;const{data:L}=k.storage.from("photos").getPublicUrl(g);await S(i,L.publicUrl)&&(x(null),h(null))}catch(s){console.error("Error returning loan:",s),w.error("Erro ao enviar foto de devolu√ß√£o.")}finally{p(!1)}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-secondary-900 dark:text-white",children:"Minhas Solicita√ß√µes"}),e.jsx("p",{className:"text-secondary-500 dark:text-secondary-400 mt-2",children:"Acompanhe o hist√≥rico de suas intera√ß√µes e avalia√ß√µes."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(a,{variant:t==="tickets"?"primary":"outline",onClick:()=>c("tickets"),children:[e.jsx(F,{className:"mr-2 h-4 w-4"})," Chamados"]}),e.jsxs(a,{variant:t==="evaluations"?"primary":"outline",onClick:()=>c("evaluations"),children:[e.jsx(f,{className:"mr-2 h-4 w-4"})," Autoavalia√ß√µes"]}),e.jsxs(a,{variant:t==="loans"?"primary":"outline",onClick:()=>c("loans"),children:[e.jsx(v,{className:"mr-2 h-4 w-4"})," Empr√©stimos"]})]}),e.jsxs("div",{className:"grid gap-6",children:[t==="tickets"&&(j.length>0?j.map(s=>e.jsx(r,{children:e.jsxs(o,{className:"pt-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-semibold
                                                ${s.status==="Conclu√≠do"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":s.status==="Em Atendimento"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"}`,children:s.status}),e.jsx("span",{className:"text-xs text-secondary-500",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsx("h3",{className:"font-semibold text-lg",children:s.category}),e.jsx("p",{className:"text-secondary-600 dark:text-secondary-400 text-sm mt-1",children:s.description})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:`text-xs font-bold uppercase ${s.urgency==="Alta"?"text-red-500":s.urgency==="M√©dia"?"text-orange-500":"text-green-500"}`,children:["Urg√™ncia ",s.urgency]})})]}),s.response&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-secondary-100 dark:border-secondary-800 w-full col-span-2",children:[e.jsx("p",{className:"text-xs font-bold text-secondary-500 uppercase mb-1",children:"Resposta do Admin"}),e.jsx("p",{className:"text-sm text-secondary-700 dark:text-secondary-300 bg-secondary-50 dark:bg-secondary-900 p-3 rounded-lg border border-secondary-200 dark:border-secondary-800",children:s.response})]})]})},s.id)):e.jsx(r,{className:"text-center py-12",children:e.jsxs(o,{children:[e.jsx(M,{className:"h-12 w-12 mx-auto text-secondary-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-secondary-900 dark:text-secondary-100",children:"Nenhum chamado encontrado"}),e.jsx("p",{className:"text-secondary-500 mb-6",children:"Voc√™ ainda n√£o abriu nenhum chamado na Central de Ajuda."}),e.jsx(m,{to:"/ajuda",children:e.jsx(a,{children:"Abrir Novo Chamado"})})]})})),t==="evaluations"&&(y.length>0?y.map(s=>e.jsx(r,{children:e.jsxs(o,{className:"pt-6",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-secondary-500",children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("span",{className:"text-xl",title:"Humor",children:s.mood<5?"üôÅ":s.mood<8?"üòê":s.mood<10?"üôÇ":"ü§©"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-secondary-500",children:"Presen√ßa"}),e.jsxs("p",{className:"font-bold",children:[s.presence,"/10"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-secondary-500",children:"Empenho"}),e.jsxs("p",{className:"font-bold",children:[s.effort,"/10"]})]})]})]})},s.id)):e.jsx(r,{className:"text-center py-12",children:e.jsxs(o,{children:[e.jsx(f,{className:"h-12 w-12 mx-auto text-secondary-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-secondary-900 dark:text-secondary-100",children:"Nenhuma avalia√ß√£o encontrada"}),e.jsx("p",{className:"text-secondary-500 mb-6",children:"Voc√™ ainda n√£o enviou nenhuma autoavalia√ß√£o."}),e.jsx(m,{to:"/autoavaliacao",children:e.jsx(a,{children:"Fazer Autoavalia√ß√£o"})})]})})),t==="loans"&&(N.length>0?N.map(s=>e.jsx(r,{children:e.jsxs(o,{className:"pt-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-semibold
                                                    ${s.status==="Ativo"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":s.status==="Atrasado"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"}`,children:s.status}),e.jsx("span",{className:"text-xs text-secondary-500",children:new Date(s.date).toLocaleDateString()})]}),e.jsx("h3",{className:"font-semibold text-lg",children:s.itemName}),e.jsxs("p",{className:"text-secondary-600 dark:text-secondary-400 text-sm mt-1",children:["Quantidade: ",s.quantity," ‚Ä¢ Tipo: ",s.type]}),s.expectedReturnDate&&e.jsxs("p",{className:"text-xs text-secondary-500 mt-1",children:["Devolu√ß√£o prevista: ",new Date(s.expectedReturnDate).toLocaleDateString()]})]}),e.jsx("div",{className:"text-right",children:s.status==="Ativo"||s.status==="Atrasado"?e.jsx(a,{size:"sm",onClick:()=>x(s.id),children:"Devolver"}):e.jsx("span",{className:"text-xs font-medium text-yellow-600 dark:text-yellow-500",children:"Aguardando aprova√ß√£o"})})]}),s.withdrawalPhotoUrl&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-xs font-medium text-secondary-500 mb-2",children:"Foto da Retirada:"}),e.jsx("img",{src:s.withdrawalPhotoUrl,alt:"Foto da retirada",className:"w-24 h-24 object-cover rounded-lg border border-secondary-200 dark:border-secondary-700"})]})]})},s.id)):e.jsx(r,{className:"text-center py-12",children:e.jsxs(o,{children:[e.jsx(v,{className:"h-12 w-12 mx-auto text-secondary-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-secondary-900 dark:text-secondary-100",children:"Nenhum empr√©stimo ativo"}),e.jsx("p",{className:"text-secondary-500 mb-6",children:"Voc√™ n√£o tem itens pendentes de devolu√ß√£o."}),e.jsx(m,{to:"/infraestrutura",children:e.jsx(a,{children:"Solicitar Material"})})]})}))]}),e.jsx(U,{isOpen:!!i,onClose:()=>x(null),title:"Devolver Item",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-secondary-600 dark:text-secondary-300",children:"Para confirmar a devolu√ß√£o, por favor envie uma foto atual do item mostrando suas condi√ß√µes."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Foto da Devolu√ß√£o (Obrigat√≥rio)"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:s=>h(s.target.files?.[0]||null),className:"hidden",id:"return-photo-upload"}),e.jsx("label",{htmlFor:"return-photo-upload",className:"flex items-center justify-center w-full p-4 border-2 border-dashed border-secondary-300 rounded-lg cursor-pointer hover:bg-secondary-50 transition-colors",children:n?e.jsxs("span",{className:"text-sm text-green-600 font-medium flex items-center",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),n.name]}):e.jsxs("span",{className:"text-sm text-secondary-500 flex items-center",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Clique para tirar ou escolher foto"]})})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx(a,{className:"w-full",onClick:E,disabled:u,children:u?"Enviando...":"Confirmar Devolu√ß√£o"})})]})})]})}export{O as default};
